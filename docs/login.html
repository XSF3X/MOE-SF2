<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دخول | MOE SF2</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        body { margin: 0; height: 100vh; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .login-card { background: #ffffff; padding: 50px 40px; border-radius: 24px; width: 100%; max-width: 380px; text-align: center; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08); border: 1px solid rgba(255, 255, 255, 0.8); }
        .logo-box { width: 90px; height: 90px; margin: 0 auto 20px; background: #f8fafc; border-radius: 20px; padding: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); }
        .logo-box img { width: 100%; height: 100%; object-fit: contain; }
        h2 { color: #0f172a; margin: 10px 0 5px; font-weight: 800; font-size: 24px; }
        .input-group { text-align: right; margin-bottom: 18px; }
        .input-group label { display: block; color: #334155; font-size: 13px; font-weight: 600; margin-bottom: 6px; }
        .input-field { width: 100%; padding: 14px 16px; border-radius: 12px; border: 1px solid #e2e8f0; background: #f8fafc; color: #0f172a; font-size: 15px; outline: none; transition: 0.3s; }
        .input-field:focus { border-color: #0ea5e9; background: #fff; }
        button { width: 100%; padding: 15px; background: linear-gradient(135deg, #0ea5e9, #0284c7); color: #fff; border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 15px; box-shadow: 0 10px 20px rgba(14, 165, 233, 0.2); }
        button:hover { transform: translateY(-2px); }
        .footer { margin-top: 30px; font-size: 12px; color: #94a3b8; }
    </style>
</head>
<body>
<div class="login-card">
    <div class="logo-box"><img src="teacher_logo.png" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2995/2995456.png'"></div>
    <h2>تسجيل الدخول</h2>
    <div class="input-group"><label>اسم المستخدم</label><input id="username" class="input-field" type="text"></div>
    <div class="input-group"><label>كلمة المرور</label><input id="password" class="input-field" type="password"></div>
    <button id="loginBtn">دخول</button>
    <div class="footer">MOE SF2 System</div>
</div>
<script>
// رابط وركر المستخدمين (يعمل صحيح)
const API = "https://moe-users.snh-saud.workers.dev/";

async function loginUser(){
    const btn = document.getElementById("loginBtn");
    const username = document.getElementById("username").value.trim().toLowerCase();
    const password = document.getElementById("password").value.trim();
    if(!username || !password) return Swal.fire({ icon: 'warning', title: 'تنبيه', text: 'أدخل البيانات' });

    btn.innerHTML = 'جاري التحقق...'; btn.disabled = true;
    try {
        const res = await fetch(API, { method: "POST", headers: {"Content-Type":"application/json"}, body: JSON.stringify({ action: "login", username, password }) });
        const data = await res.json();
        if(!data.success) {
            Swal.fire({ icon: 'error', title: 'خطأ', text: 'بيانات غير صحيحة' });
            btn.innerHTML = 'دخول'; btn.disabled = false;
        } else {
            sessionStorage.setItem("loggedInUser", JSON.stringify(data.user));
            window.location.href = data.user.role === "admin" ? "admin.html" : "index.html";
        }
    } catch(e) {
        Swal.fire({ icon: 'error', title: 'خطأ', text: 'فشل الاتصال' });
        btn.innerHTML = 'دخول'; btn.disabled = false;
    }
}
document.getElementById("loginBtn").onclick = loginUser;
document.addEventListener("keydown", (e) => { if (e.key === "Enter") loginUser(); });
</script>
</body>
</html>
